import psycopg2
con = psycopg2.connect(
            host = "localhost",
            database="production",
            user = "postgres",
            password = "cheesecake12")
try:
    cur=con.cursor()
    query1=("select * from product")
    query2=("select * from depot")
    query3=("select * from stock")
    query4=("delete from depot where dep='d1'")

    cur.execute(query4)


    cur.execute(query1)
    rows1=cur.fetchall()
    print("Product table")
    for r in rows1:

        print(f"prod {r[0]} pname {r[1]} price {r[2]}")
    cur.execute(query2)
    rows2 = cur.fetchall()
    print("Depot Table")
    for r in rows2:

        print(f"dep {r[0]} addr {r[1]} volume {r[2]}")

    cur.execute(query3)
    rows3 = cur.fetchall()
    print("Stock Table")
    for r in rows3:

        print(f"dep {r[0]} prod {r[1]} quantity {r[2]}")



    con.commit()
    print("Transaction successful")
except (Exception, psycopg2.DatabaseError) as err:
    print(err)
    print("Transactions could not be completed so database will be rolled back before start of transactions")
    con.rollback()
finally:
    if (con):
        cur.close
        con.close
        print("PostgreSQL connection is now closed")




